const GLOBAL_COLORS = {
  Yacc: "#4B6C4B",
  "AGS Script": "#B9D9FF",
  "API Blueprint": "#2ACCA8",
  "C Sharp": "#178600",
  "C++": "#F34B7D",
  "ColdFusion CFC": "#ed2cd6",
  "Common Lisp": "#3fb68b",
  "Component Pascal": "#b0ce4e",
  "Emacs Lisp": "#c065db",
  "F#": "#b845fc",
  "Game Maker Language": "#8fb200",
  "Grammatical Framework": "#79aa7a",
  "Jupyter Notebook": "#DA5B0B",
  "NetLinx+ERB": "#747faa",
  "Objective-C": "#438eff",
  "Objective-C++": "#6866fb",
  "Objective-J": "#ff0c5a",
  "Propeller Spin": "#7fa2a7",
  "Pure Data": "#91de79",
  "Ragel in Ruby Host": "#9d5200",
  "Ren'Py": "#ff7f7f",
  "Standard ML": "#dc566d",
  "Unified Parallel C": "#4e3617",
  "Unity3D Asset": "#ab69a1",
  "Visual Basic": "#945db7",
  "Web Ontology Language": "#9cc9dd",
  ABAP: "#E8274B",
  ActionScript: "#882B0F",
  Ada: "#02f88c",
  Agda: "#315665",
  Alloy: "#64C800",
  AMPL: "#E6EFBB",
  ANTLR: "#9DC3FF",
  APL: "#5A8164",
  Arc: "#aa2afe",
  Arduino: "#bd79d1",
  ASP: "#6a40fd",
  AspectJ: "#a957b0",
  Assembly: "#6E4C13",
  ATS: "#1ac620",
  AutoHotkey: "#6594b9",
  AutoIt: "#1C3552",
  BlitzMax: "#cd6400",
  Boo: "#d4bec1",
  Brainfuck: "#2F2530",
  C: "#555555",
  Chapel: "#8dc63f",
  Cirru: "#ccccff",
  Clarion: "#db901e",
  Clean: "#3F85AF",
  Click: "#E4E6F3",
  Clojure: "#db5855",
  CoffeeScript: "#244776",
  ColdFusion: "#ed2cd6",
  cpp: "#f34b7d",
  Crystal: "#776791",
  CSS: "#563d7c",
  D: "#ba595e",
  Dart: "#00B4AB",
  Diff: "#88dddd",
  DM: "#447265",
  Dogescript: "#cca760",
  Dylan: "#6c616e",
  E: "#ccce35",
  Eagle: "#814C05",
  eC: "#913960",
  ECL: "#8a1267",
  edn: "#db5855",
  Eiffel: "#946d57",
  Elixir: "#6e4a7e",
  Elm: "#60B5CC",
  EmberScript: "#FFF4F3",
  Erlang: "#B83998",
  Factor: "#636746",
  Fancy: "#7b9db4",
  Fantom: "#dbded5",
  FLUX: "#88ccff",
  Forth: "#341708",
  FORTRAN: "#4d41b1",
  FreeMarker: "#0050b2",
  Frege: "#00cafe",
  Glyph: "#e4cc98",
  Gnuplot: "#f0a9f0",
  Go: "#375eab",
  Golo: "#88562A",
  Gosu: "#82937f",
  Groovy: "#e69f56",
  Handlebars: "#01a9d6",
  Harbour: "#0e60e3",
  Haskell: "#29b544",
  Haxe: "#df7900",
  HTML: "#e44b23",
  Hy: "#7790B2",
  IDL: "#a3522f",
  Io: "#a9188d",
  Ioke: "#078193",
  Isabelle: "#FEFE00",
  J: "#9EEDFF",
  Java: "#b07219",
  JavaScript: "#f1e05a",
  JFlex: "#DBCA00",
  JSONiq: "#40d47e",
  Julia: "#a270ba",
  Kotlin: "#F18E33",
  KRL: "#28431f",
  Lasso: "#999999",
  Latte: "#A8FF97",
  Lex: "#DBCA00",
  LFE: "#004200",
  LiveScript: "#499886",
  LOLCODE: "#cc9900",
  LookML: "#652B81",
  LSL: "#3d9970",
  Lua: "#000080",
  Makefile: "#427819",
  Mask: "#f97732",
  Matlab: "#bb92ac",
  Max: "#c4a79c",
  MAXScript: "#00a6a6",
  Mercury: "#ff2b2b",
  Metal: "#8f14e9",
  Mirah: "#c7a938",
  MTML: "#b7e1f4",
  NCL: "#28431f",
  Nemerle: "#3d3c6e",
  nesC: "#94B0C7",
  NetLinx: "#0aa0ff",
  NetLogo: "#ff6375",
  NewLisp: "#87AED7",
  Nimrod: "#37775b",
  Nit: "#009917",
  Nix: "#7e7eff",
  Nu: "#c9df40",
  OCaml: "#3be133",
  Omgrofl: "#cabbff",
  ooc: "#b0b77e",
  Opal: "#f7ede0",
  Oxygene: "#cdd0e3",
  Oz: "#fab738",
  Pan: "#cc0000",
  Papyrus: "#6600cc",
  Parrot: "#f3ca0a",
  Pascal: "#b0ce4e",
  PAWN: "#dbb284",
  Perl: "#0298c3",
  Perl6: "#0000fb",
  PHP: "#4F5D95",
  PigLatin: "#fcd7de",
  Pike: "#005390",
  PLSQL: "#dad8d8",
  PogoScript: "#d80074",
  Processing: "#0096D8",
  Prolog: "#74283c",
  Puppet: "#302B6D",
  PureBasic: "#5a6986",
  PureScript: "#1D222D",
  Python: "#3572A5",
  QML: "#44a51c",
  R: "#198ce7",
  Racket: "#22228f",
  RAML: "#77d9fb",
  Rebol: "#358a5b",
  Red: "#ee0000",
  Rouge: "#cc0088",
  Ruby: "#701516",
  Rust: "#dea584",
  SaltStack: "#646464",
  SAS: "#B34936",
  Scala: "#DC322F",
  Scheme: "#1e4aec",
  Self: "#0579aa",
  Shell: "#89e051",
  Shen: "#120F14",
  Slash: "#007eff",
  Slim: "#ff8f77",
  Smalltalk: "#596706",
  SourcePawn: "#5c7611",
  SQF: "#3F3F3F",
  Squirrel: "#800000",
  Stan: "#b2011d",
  SuperCollider: "#46390b",
  Swift: "#ffac45",
  SystemVerilog: "#DAE1C2",
  Tcl: "#e4cc98",
  TeX: "#3D6117",
  Turing: "#45f715",
  TypeScript: "#2b7489",
  UnrealScript: "#a54c4d",
  Vala: "#fbe5cd",
  Verilog: "#b2b7f8",
  VHDL: "#adb2cb",
  VimL: "#199f4b",
  Volt: "#1F1F1F",
  Vue: "#2c3e50",
  wisp: "#7582D1",
  X10: "#4B6BEF",
  xBase: "#403a40",
  XC: "#99DA07",
  XQuery: "#5232e7",
  Zephir: "#118f9e",
};
const GLOBAL_EXTENTIONS = {
  asp: "ASP",
  aspx: "ASP",
  "aspx-vb": "ASP",
  as3: "ActionScript",
  apache: "ApacheConf",
  nasm: "Assembly",
  bat: "Batchfile",
  "c#": "C#",
  csharp: "C#",
  c: "C",
  "c++": "C++",
  cpp: "C++",
  chpl: "Chapel",
  coffee: "CoffeeScript",
  "coffee-script": "CoffeeScript",
  cfm: "ColdFusion",
  "common-lisp": "Common Lisp",
  lisp: "Common Lisp",
  dpatch: "Darcs Patch",
  dart: "Dart",
  elisp: "Emacs Lisp",
  emacs: "Emacs Lisp",
  "emacs-lisp": "Emacs Lisp",
  pot: "Gettext Catalog",
  html: "HTML",
  xhtml: "HTML",
  "html+erb": "HTML+ERB",
  erb: "HTML+ERB",
  irc: "IRC log",
  json: "JSON",
  jsp: "Java Server Pages",
  java: "Java",
  javascript: "JavaScript",
  js: "JavaScript",
  lhs: "Literate Haskell",
  "literate-haskell": "Literate Haskell",
  objc: "Objective-C",
  openedge: "OpenEdge ABL",
  progress: "OpenEdge ABL",
  abl: "OpenEdge ABL",
  pir: "Parrot Internal Representation",
  posh: "PowerShell",
  puppet: "Puppet",
  "pure-data": "Pure Data",
  raw: "Raw token data",
  rb: "Ruby",
  ruby: "Ruby",
  r: "R",
  scheme: "Scheme",
  bash: "Shell",
  sh: "Shell",
  shell: "Shell",
  zsh: "Shell",
  supercollider: "SuperCollider",
  tex: "TeX",
  ts: "TypeScript",
  vim: "Vim script",
  viml: "Vim script",
  rst: "reStructuredText",
  xbm: "X BitMap",
  xpm: "X PixMap",
  yml: "YAML",
};
const newNode = (
  type = "div",
  content = "",
  id = "",
  classList = [],
  attributeList = []
) => {
  let node = document.createElement(type);
  if (id !== "") {
    node.setAttribute("id", id);
  }
  if (classList.length) {
    classList.forEach((className) => {
      node.classList.add(className);
    });
  }
  if (attributeList.length) {
    for (let i = 0; i < attributeList.length; i++) {
      node.setAttribute(
        Object.keys(attributeList[i])[0],
        Object.values(attributeList[i])[0]
      );
    }
  }
  if (content !== "") {
    node.innerHTML = content;
  }
  return node;
};

const languagesOverview = (langObj, oldChart) => {
  let data = [];
  let backgroundColor = [];
  let labels = [];
  for (let key in langObj) {
    data.push(langObj[key]);
    backgroundColor.push(GLOBAL_COLORS[GLOBAL_EXTENTIONS[key]]);
    labels.push(key);
  }
  let len = data.length;
  let swapped;
  do {
    swapped = false;
    for (let i = 0; i < len; i++) {
      if (data[i] > data[i + 1]) {
        let tmpData = data[i];
        data[i] = data[i + 1];
        data[i + 1] = tmpData;
        let tmpBackgroundColor = backgroundColor[i];
        backgroundColor[i] = backgroundColor[i + 1];
        backgroundColor[i + 1] = tmpBackgroundColor;
        let tmpLabels = labels[i];
        labels[i] = labels[i + 1];
        labels[i + 1] = tmpLabels;

        swapped = true;
      }
    }
  } while (swapped);

  let ctx = document.getElementById("main-chart");
  if (oldChart) oldChart.destroy();
  let myChart = new Chart(ctx, {
    type: "doughnut",
    data: {
      datasets: [
        {
          data,
          backgroundColor,
        },
      ],
      labels,
    },
    options: {},
  });
  return myChart;
};

const createChart = (chartCanvas, languages) => {
  let labels = [];
  let data = [];
  let barColors = [];
  languages.forEach((element) => {
    labels.push(element.name);
    data.push(element.size);
    barColors.push(GLOBAL_COLORS[element.name]);
  });
  let total = data.reduce((a, b) => a + b, 0);
  for (let i = 0; i < data.length; i++) {
    data[i] = (data[i] / total) * 100;
    data[i] = Math.round((data[i] + Number.EPSILON) * 100) / 100;
  }
  let myChart = new Chart(chartCanvas, {
    type: "bar",
    data: {
      labels,
      datasets: [
        {
          label: "%",
          data,
          barPercentage: 0.5,
          barThickness: 6,
          maxBarThickness: 8,
          minBarLength: 2,
          backgroundColor: barColors,
          borderColor: barColors,
          borderWidth: 1,
        },
      ],
    },
    options: {
      legend: {
        display: false,
        labels: {
          fontColor: "rgb(255, 99, 132)",
          fontSize: 8,
        },
      },
      scales: {
        yAxes: [
          {
            ticks: {
              beginAtZero: true,
            },
          },
        ],
        xAxes: [
          {
            ticks: {
              display: false, //this will remove only the label
              // fontSize: 8,
            },
          },
        ],
      },
    },
  });
};

const buildCard = (repoInfo) => {
  console.log(repoInfo);
  const repos = document.getElementById("repos");
  let card = newNode("div", "", "", ["card"], []);
  let chart = newNode("canvas", "", repoInfo.name);
  let chartWrapper = newNode("div", "", "", ["chart"]);
  let cardContent = newNode("div", "", "", ["card-body"], []);
  let title = newNode("div", repoInfo.name, "", ["card-title"], []);
  let link = newNode(
    "a",
    "go to repo",
    "",
    ["card-link"],
    [{ href: repoInfo.link }, { target: "_blank" }]
  );
  let contributions = newNode(
    "div",
    `${repoInfo.contributions} Commits`,
    "",
    ["card-contributions"],
    []
  );
  let languages = newNode("div", "", "", ["card-languages"], []);
  let description = newNode(
    "div",
    repoInfo.description,
    "",
    ["card-description"],
    []
  );
  createChart(chart, repoInfo.languages);
  cardContent.appendChild(description);
  chartWrapper.appendChild(chart);
  cardContent.appendChild(chartWrapper);
  card.appendChild(title);
  card.appendChild(link);
  card.appendChild(cardContent);
  card.appendChild(contributions);
  repos.appendChild(card);
};

const buildPortfolio = (user) => {
  console.log("here", user);
  let portfolio = document.getElementById("portfolio");
  let portfolioWrapper = newNode("div", "", "", ["portfolio-container"], []);
  let chartWrapper = newNode("div", "", "", ["chart"]);
  let chart = newNode("canvas", "", "main-chart");
  let userInfo = newNode("div", "", "", ["user-info"], []);
  let userDetails = newNode("div", "", "", ["user-info"], []);
  let avatar = newNode(
    "div",
    "",
    "",
    ["avatar"],
    [{ style: `background-image: url(${user.avatar_url})` }]
  );
  let name = newNode("div", user.name, "", ["name"], []);
  let bio = newNode("div", user.bio, "", ["bio"], []);

  let blogUrl = newNode(
    "a",
    user.blog,
    "",
    ["line-content"],
    [{ href: user.blog }, { target: "_blank" }, { "data-icon": "site" }]
  );
  let email = newNode(
    "a",
    user.email,
    "",
    ["line-content"],
    [{ href: `mailto:${user.email}` }, { "data-icon": "mail" }]
  );
  let followers = newNode(
    "div",
    `${user.followers} followers`,
    "",
    ["line-content"],
    [{ "data-icon": "followers" }]
  );
  let ghUrl = newNode(
    "a",
    user.login,
    "",
    ["line-content"],
    [{ href: user.html_url }, { target: "_blank" }, { "data-icon": "gh" }]
  );
  let location = newNode(
    "div",
    user.location,
    "",
    ["line-content"],
    [{ "data-icon": "location" }]
  );
  let publicRepos = newNode(
    "div",
    `${user.public_repos} public repos`,
    "",
    ["line-content"],
    [{ "data-icon": "repo" }]
  );

  let linesArray = [blogUrl, email, followers, ghUrl, location, publicRepos];

  linesArray.forEach((element) => {
    console.log(element.innerHTML);

    if (element.innerHTML !== "") {
      let line = newNode("div", "", "", ["detail-line"], []);
      let icon = newNode(
        "div",
        "",
        "",
        ["icon"],
        [
          {
            style: `background-image: url(../img/${element.getAttribute(
              "data-icon"
            )}.svg)`,
          },
        ]
      );
      line.appendChild(icon);
      line.appendChild(element);
      userDetails.appendChild(line);
    }
  });

  chartWrapper.appendChild(chart);

  userInfo.appendChild(avatar);
  userInfo.appendChild(name);
  userInfo.appendChild(bio);
  userInfo.appendChild(userDetails);
  portfolioWrapper.appendChild(userInfo);
  portfolioWrapper.appendChild(chartWrapper);
  portfolio.appendChild(portfolioWrapper);
};
